# 2023.11.06 - 2023.11.10
## 并发控制：

https://marsishandsome.github.io/2019/06/Multi_Version_Concurrency_Control
- 悲观：2PL
- 乐观：timestamp based 因为乐观并发的流程为：先write in private space再validation然后commit。而validation是base on timestamp的。
   - Basic T/O：原地修改，会有Dirty Write的问题
   - OCC：Copy then modify。 内存占用大，无法应对大数据集

以上都是单版本的实现。结合MVCC，分别就是MV2PL、MVOCC、MVTO

## 事务：
A Critical of database isolation 定义了P0123，更进一步的，提出Snapshot Isolation、A5A和A5B，也就是读写偏斜问题。

Snapshot Isolation解决了幻读，所以隔离级别高于Read Committed

但SI无法和Repeatable Read比较。因为后者无法解决幻读；基于锁的实现方式可以避免Write Skew，SI无法避免Write Skew

因为SI无法避免Write Skew，所以其并不是Serializable。

所以又有了serializable snapshot isolation和write snapshot isolation ，与base SI相比，解决了Write Skew(r1x r2y w1y w2x)问题。
how？
《Making Snapshot Isolation Serializable》记录了SI出现Write Skew的必要条件：事务之间存在依赖环（ww or rw or wr），且有两个连续的rw依赖（即有一个事务即是一个rw的writer，也是另一个rw的reader）

所以关键点就是检测到这个条件（必要不充分条件）。

### Serializable Isolation for Snapshot Databases
《Serializable Isolation for Snapshot Databases》记录了这个处理方法。方法是给事务加两个bool字段，分别记录是否是rw的出边和入边，both true则 abort

### A Critique of Snapshot Isolation
《A Critique of Snapshot Isolation》提出了write-snapshot-isolation，提到解决ww冲突不是实现serializability的必要条件，解决rw冲突就足够了


todo：
- A Critique of Snapshot Isolation论文阅读
- crdb、pg的ssi实现
